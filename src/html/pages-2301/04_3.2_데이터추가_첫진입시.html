<!DOCTYPE HTML>
<html lang="ko">
@@include('../include/head.html')

<body>
    <div class="wrap renewal">
        <div class="header fixed">
            <h2>공유 데이터 추가</h2>
            <a href="#" class="sprite btn_close"></a>
        </div>
        <div class="contents expenditure share-spend-money share-add pt-66">
            <div class="text-descriptiton mb-30">
                <p class="title">
                    <span class="f-point">공유하고 싶은 <br /> 데이터와 시작일</span>
                    을 선택해주세요<img src="../../img/common/ico_tooltip@2x.png" alt="tooltip">
                </p>
                <p class="desc">공유 데이터의 상품명 및 공유 범위는 <br />[공동관리 >프로필]을 클릭하여 수정할 수 있어요</p>
            </div>

            <div id="manage-tab" class="expenditure-tab manage-tab _expenditureTab sticky-top sticky mb-30"
                style="border-bottom: 1px solid #e3e4e8; overflow: hidden;">
                <ul>
                    <li class="active"><a href="#share-item-01">카드 <span class="f-point bold">2</span></a></li>
                    <li><a href="#share-item-02">계좌</a></li>
                    <li><a href="#share-item-03">투자</a></li>
                    <li><a href="#share-item-04">연금</a></li>
                    <li><a href="#share-item-05">대출</a></li>
                    <li><a href="#share-item-06">보험</a></li>
                    <li><a href="#share-item-07">기타</a></li>
                </ul>
            </div>

            <div class="agree-wrap agree-wrap-reverse padding-default-x">
                <div class="select-all-box">
                    <span>전체 선택</span>
                    <label>
                        <input type="checkbox" class="filled-in">
                        <span></span>
                    </label>
                </div>
            </div>
            <script type="text/javascript">
                $('.select-all-box').on('click', function () {
                    if ($(this).hasClass('checked')) {
                        $(this).removeClass('checked')
                            .find('input').prop('checked', false)
                    } else {
                        $(this).addClass('checked')
                            .find('input').prop('checked', true)
                    }
                })
            </script>

            <div class="expenditure-box" style="padding-bottom: 100px;">
                <ul class="usage-history-list usage-category-list filter-setting " style="padding:20px 20px;">
                    <li id="share-item-01" class="share-item">
                        <div class="title-category justify-content-between">
                            <span>카드 <span class="f-point bold">2</span></span>
                            <label>
                                <input type="checkbox" class="filled-in">
                                <span></span>
                            </label>
                        </div>
                        <ul class="details-history">
                            <li class="item-list">
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_uribank@2x.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>우리편한입출금통장</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_kbbank@2x.png" class="img-ci" alt="국민은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>국민은행 카드</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in">
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_samsung@2x.png" class="img-ci" alt="삼성카드 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>삼성 taptap O</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in">
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li id="share-item-02" class="share-item">
                        <div class="title-category justify-content-between">
                            <span>계좌 <span class="f-point bold">2</span></span>
                            <label>
                                <input type="checkbox" class="filled-in">
                                <span></span>
                            </label>
                        </div>
                        <ul class="details-history">
                            <li class="item-list">
                                <div class="name">입출금</div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_uribank@2x.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>우리편한입출금통장</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_kbbank@2x.png" class="img-ci" alt="국민은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>국민은행 카드</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in">
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                            <li class="item-list">
                                <div class="name">예적금</div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_kbbank@2x.png" class="img-ci" alt="국민은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>국민은행 카드</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in">
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                            <li class="item-list">
                                <div class="name">외화</div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_samsung@2x.png" class="img-ci" alt="삼성카드 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>삼성 taptap O</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in">
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li id="share-item-03" class="share-item">
                        <div class="title-category justify-content-between">
                            <span>투자 <span class="f-point bold">2</span></span>
                            <label>
                                <input type="checkbox" class="filled-in">
                                <span></span>
                            </label>
                        </div>
                        <ul class="details-history">
                            <li class="item-list">
                                <div class="name">국내</div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_uribank@2x.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>우리편한입출금통장</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                            <li class="item-list">
                                <div class="name">해외</div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_kbbank@2x.png" class="img-ci" alt="국민은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>국민은행 카드</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in">
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li id="share-item-04" class="share-item">
                        <div class="title-category justify-content-between">
                            <span>연금 <span class="f-point bold">2</span></span>
                            <label>
                                <input type="checkbox" class="filled-in">
                                <span></span>
                            </label>
                        </div>
                        <ul class="details-history">
                            <li class="item-list">
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_uribank@2x.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>우리 여수신 IRP</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_uribank@2x.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>우리 여수신 IRP</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li id="share-item-05" class="share-item">
                        <div class="title-category justify-content-between">
                            <span>대출 <span class="f-point bold">2</span></span>
                            <label>
                                <input type="checkbox" class="filled-in">
                                <span></span>
                            </label>
                        </div>
                        <ul class="details-history">
                            <li class="item-list">
                                <div class="name">대출</div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_uribank@2x.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>하나은행 은행은행 은행은행대출명 최대 두줄 처리 하나은행 은행은행 은행은행대출명 최대 두줄
                                                    처리</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/ci_uribank@2x.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>KB 주택담보대출</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                            <li class="item-list">
                                <div class="name">보험대출</div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/hana.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>하나은행 은행은행 은행은행대출명 최대 두줄 처리 하나은행 은행은행 은행은행대출명 최대 두줄
                                                    처리</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                            <li class="item-list">
                                <div class="name">운용리스</div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/hyundai.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>하나은행 은행은행 은행은행대출명 최대 두줄 처리</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li id="share-item-06" class="share-item">
                        <div class="title-category justify-content-between">
                            <span>보험 <span class="f-point bold">0</span></span>
                            <label>
                                <input type="checkbox" class="filled-in">
                                <span></span>
                            </label>
                        </div>
                        <ul class="details-history">
                            <li class="item-list">
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/hanwha.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>흥국생명 보험</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/hanwha.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>흥국생명 보험</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <img src="../../img/@temp/hanwha.png" class="img-ci" alt="우리은행 로고">
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>흥국생명 보험</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li id="share-item-07" class="share-item">
                        <div class="title-category justify-content-between">
                            <span>기타 <span class="f-point bold">0</span></span>
                            <label>
                                <input type="checkbox" class="filled-in">
                                <span></span>
                            </label>
                        </div>
                        <ul class="details-history">
                            <li class="item-list">
                                <div class="group">
                                    <div class="box">
                                        <div class="img">
                                            <i class="icon icon_cate_subscript"></i>
                                        </div>
                                        <div class="info">
                                            <span class="place"><span>현금</span></span>
                                        </div>
                                    </div>
                                    <div>
                                        <label>
                                            <input type="checkbox" class="filled-in" checked>
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
                <div class="box-mydata">
                    <p class="desc">공유하려는 데이터가 안보인다면?</p>
                    <a href="#">마이데이터 연결하기<i class="sprite icon ico_arrow_small_nor"></i></a>
                </div>
            </div>

            <div class="padding-default fixed-bottom bg-white pt-0">
                <div class="btn-wrap">
                    <a href="#" class="btn btn-block btn-lg btn-purple-bg">다음</a>
                </div>
            </div>
        </div>
    </div>
    <script>


        // const tabs = document.getElementById('manage-tab');
        // const tabsUl = tabs.querySelector('ul');
        // window.addEventListener('scroll', function () {
        //     const io = new IntersectionObserver(entries => {
        //         entries.forEach((entry, index) => {
        //             // entry의 target으로 DOM에 접근합니다.
        //             const $target = entry.target;

        //             // 화면에 노출 상태에 따라 해당 엘리먼트의 class를 컨트롤 합니다.
        //             if (entry.boundingClientRect.top <= (66 + 52 + 20)) {
        //                 $target.classList.add("active");
        //             } else {
        //                 $target.classList.remove("active");
        //             }
        //         });
        //     });

        //     // 옵저버할 대상 DOM을 선택하여 옵저버 시작합니다.
        //     const contentLi = document.querySelectorAll('.filter-setting > li');
        //     contentLi.forEach(item => {
        //         io.observe(item);
        //     });
        // })




        // 스로틀 이벤트
        const throttle = (fn, delay) => {
            let timer
            return function () {
                if (!timer) {
                    timer = setTimeout(() => {
                        timer = null
                        fn.apply(this, arguments)
                    }, delay)
                }
            }
        }


        // 재 작업
        const tabs = document.getElementById('manage-tab');
        const tabsUl = tabs.querySelector('ul');
        let activeTabIndex = 0;
        let bool = true;

        initializeTabs()

        function initializeTabs() {
            const tabItem = tabsUl.querySelectorAll('li')
            tabItem.forEach((tab, index) => {
                tab.addEventListener('click', () => handleTabClick(index));
            })

            window.addEventListener('scroll', throttle(handleScroll, 400))
            setActiveTab(activeTabIndex);
        }
        function handleTabClick(index) {
            bool = false;
            setTimeout(() => bool = true, 400);
            // if (bool) {
            setActiveTab(index);
            // }
            scrollToContent(`share-item-0${index + 1}`);
        }

        // 탭 클릭
        function setActiveTab(index) {
            activeTabIndex = index;
            const tabs = tabsUl.querySelectorAll('li');

            tabs.forEach((tab, tabIndex) => {
                const link = tab;
                if (tabIndex === index) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            centerActiveTab();
        }

        // 스크롤 될때 탭 active
        function handleScroll() {
            const contentLi = document.querySelectorAll('.filter-setting > li');
            contentLi.forEach((contentLi, index) => {
                const rect = contentLi.getBoundingClientRect();
                if (rect.top <= (66 + 52 + 60 + 20) && rect.bottom - (66 + 52 + 60 + 20) <= window.innerHeight) { //header - tab - .group - liMarginBottom
                    if (bool) {
                        setActiveTab(index);
                    }
                }
            });
            // 화면 스크롤 끝나면 탭 마지막 활성화
            scrollToBot(index)
        }

        // 스크롤되면 탭 scrollLeft
        function centerActiveTab() {
            const tabs = document.getElementById('manage-tab');
            const tabsUl = tabs.querySelector('ul');
            const activeTab = tabs.querySelector('.active');

            if (!activeTab) return;

            const containerWidth = tabs.offsetWidth;  //ul width  375
            const activeTabWidth = activeTab.offsetWidth;  //li width  45
            let activeTabLeft = activeTab.offsetLeft; // 좌로부터 간격

            let scrollLeft = activeTabLeft - (containerWidth - activeTabWidth) / 2;

            tabsUl.scrollTo({
                left: scrollLeft,
                behavior: 'smooth'
            });
        }

        // 스크롤 부드럽게
        function scrollToContent(sectionId) {
            const targetDiv = document.getElementById(sectionId);
            const targetOffset = targetDiv.offsetTop;
            const currentScrollTop = document.documentElement.scrollTop || document.body.scrollTop;

            const distance = targetOffset - currentScrollTop;
            const duration = 500;
            const startTime = performance.now();

            function scrollStep(timestamp) {
                const currentTime = timestamp - startTime;
                const progress = currentTime / duration;

                const easeInOutQuad = t => t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
                const easeProgress = easeInOutQuad(Math.min(progress, 1));

                document.documentElement.scrollTop = (document.body.scrollTop = currentScrollTop + distance * easeProgress) - (66 + 52);

                if (currentTime < duration) {
                    requestAnimationFrame(scrollStep);
                }
            }
            requestAnimationFrame(scrollStep);
        }

        function scrollToBot(index) {
            let scrT = $(window).scrollTop()
            const tabItem = tabsUl.querySelectorAll('li')
            if (scrT >= $(document).height() - $(window).height()) {
                // console.log(tabItem)
                setActiveTab(tabItem.length - 1)
            }
        }

    </script>
</body>

</html>