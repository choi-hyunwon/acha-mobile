<!DOCTYPE HTML>
<html lang="ko">
@@include('../include/head.html')
<body>
<div class="wrap renewal">
    <div class="header _sticky">
        <a href="#" class="sprite btn_back"></a>
        <h2>소비 분석</h2>
    </div>
    <div class="contents lifestyle pb-0">
        <div class="spend-analysis-wrap">
            <p class="title accent">
                <span class="name">김유비</span>님의 최근 3개월 <br><span class="f-point">소비를 분석</span>했어요!
            </p>
            <p class="noti">✽ 유플래너 기본 카테고리만 반영해요</p>

            <div class="mt-30">
                <canvas id="myChart" width="265" height="243"></canvas>
            </div>

            <div class="bar-graph-wrap">
                <p class="title">카테고리별 지출</p>
                <ul class="bar-graph-list">
                    <!-- li의 class는 그래프의 순위입니다.
                        순위별로 그래프 색상이 달라집니다. (6위까지) -->
                    <li class="first">
                        <div class="subject">
                            <span class="category_A025">반려동물</span>
                            <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a>
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 100%"></span>
                        </div>
                        <p><span class="amount">19,000,000</span>원</p>
                    </li>
                    <li class="second">
                        <div class="subject">
                            <span class="category_A009">마트/편의점</span>
                            <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a>
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 75%"></span>
                        </div>
                        <p><span class="amount">600,000</span>원</p>
                    </li>
                    <li class="third">
                        <div class="subject">
                            <span class="category_A015">미용</span>
                            <!-- <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a> -->
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 60%"></span>
                        </div>
                        <p><span class="amount">300,000</span>원</p>
                    </li>
                    <li class="fourth">
                        <div class="subject">
                            <span class="category_A020">용돈/생활비</span>
                            <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a>
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 35%"></span>
                        </div>
                        <p><span class="amount">60,000</span>원</p>
                    </li>
                    <li class="fifth">
                        <div class="subject">
                            <span class="category_A011">카페/간식</span>
                            <!-- <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a> -->
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 20%"></span>
                        </div>
                        <p><span class="amount">50,000</span>원</p>
                    </li>
                    <li class="sixth">
                        <div class="subject">
                            <span class="category_A003">보험</span>
                            <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a>
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 15%"></span>
                        </div>
                        <p><span class="amount">50,000</span>원</p>
                    </li>
                    <li class="etc">
                        <div class="subject">
                            <span class="category_A004">주거/통신</span>
                            <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a>
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 10%"></span>
                        </div>
                        <p><span class="amount">10,000</span>원</p>
                    </li>
                    <li class="etc">
                        <div class="subject">
                            <span class="category_A016">취미/여가</span>
                            <!-- <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a> -->
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 8%"></span>
                        </div>
                        <p><span class="amount">7,800</span>원</p>
                    </li>
                    <li class="etc">
                        <div class="subject">
                            <span class="category_A015">미용</span>
                            <!-- <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a> -->
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 5%"></span>
                        </div>
                        <p><span class="amount">7,000</span>원</p>
                    </li>
                    <li class="etc">
                        <div class="subject">
                            <span class="category_A006">교육</span>
                            <a href="#">관련 혜택 카드보기 <i class="sprite icon ico_arrow_small_nor"></i></a>
                        </div>
                        <div class="bar-graph">
                            <span class="bar" style="width: 3%"></span>
                        </div>
                        <p><span class="amount">1,000</span>원</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
    type: 'bubble',
    data: {
        datasets: [{
            data: [
                {
                    x: 10,
                    y: 10,
                    r: 55,
                    img: "../../img/common/lifestyle/ico_A025.png",
                    txt: "반려동물"
                }, 
                {
                    // x: 0, 
                    // y: 18,
                    x: 10, 
                    y: 18,
                    r: 44,
                    img: "../../img/common/lifestyle/ico_A009.png",
                    txt: "마트/편의점"
                },
                {
                    x: 18,
                    y: 0,
                    r: 40,
                    img: "../../img/common/lifestyle/ico_A015.png",
                    txt: "미용"
                },
                {
                    x: 4,
                    y: 0,
                    r: 38,
                    img: "../../img/common/lifestyle/ico_A020.png",
                    txt: "용돈/생활비"
                },
                {
                    x: 16,
                    y: 20,
                    r: 35,
                    img: "../../img/common/lifestyle/ico_A011.png",
                    txt: "카페/간식"
                    
                },
                {
                    x: 0,
                    y: 8,
                    r: 32,
                    img: "../../img/common/lifestyle/ico_A003.png",
                    txt: "보험"
                },
                {
                    // x: 20,
                    // y: 10,
                    x: 20,
                    y: 5,
                    r: 29,
                    txt: "그 외 4개"
                },
            ],
            backgroundColor: [
                'rgba(255, 168, 29, 0.12)',
                'rgba(92, 136, 255, 0.12)',
                'rgba(250, 115, 152, 0.12)',
                'rgba(130, 110, 255, 0.12)',
                'rgba(171, 110, 255, 0.12)',
                'rgba(255, 0, 0, 0.12)',
                'rgba(163, 157, 177, 0.12)',
            ],
            borderWidth: 0,
        }]
    },
    gridLines: {
        display: false
    },
    ticks: {
        display: false
    },
    options: {
        responsive: true,
        scales: {
            x: {
                display: false,
                ticks: {
                    display: false, 
                },
                gridLines: {
                    display: false, 
                },
                grid: {
                    display: false,
                }
            },
            y: {
                display: false,
                ticks: {
                    display: false, 
                },
                gridLines: {
                    display: false, 
                },
                grid: {
                    display: false,
                }
            }
        },
        plugins: {
            legend: {
                display: false,
            },
            title: {
                display: false,
            },
        }
    },
    plugins: [
        {
            id: 'custom',
            afterDraw(chart) {
            const ctx = chart.ctx;
            const datasets = chart.data.datasets;

            datasets.forEach(dataset => {
                dataset.data.forEach((point, index) => {
                    const x = chart.scales.x.getPixelForValue(point.x);
                    const y = chart.scales.y.getPixelForValue(point.y);
                    const scaleFactor = 0.7;

                    if (point.img) {
                        const img = new Image();
                        img.src = point.img;
                        const size = point.r;
                        const fixedSize = point.r * scaleFactor;
                        img.onload = () => {
                            ctx.drawImage(img, x - fixedSize / 2, y - fixedSize / 2 - point.r / 3, fixedSize, fixedSize);
                        };
                    }

                    ctx.font = '13px NotoSansCJKKR';
                    ctx.fillStyle = '#37354e';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';

                    const lines = (point.txt || 'Text').split('\n');
                    const lineHeight = 1.3;

                    console.log(point.txt[0]);
                    
                    if(point.txt === "그 외 4개"){
                        ctx.fillText(point.txt || 'Text', x, y);
                    } else {
                        ctx.fillText(point.txt || 'Text', x, y + point.r / 3);
                    }
                });
            });
        }
        },
    ]
    });
</script>
</body>
</html>